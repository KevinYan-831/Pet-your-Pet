# Pet Your Pet - Full Stack Pet Community Application

## Overview
Pet Your Pet is a full-stack web application where users can create customized profiles for their pets and participate in a virtual pet community. The application features user authentication, pet profile management, and interactive pet features.

**Live Site:** https://petyourpet.online/

## Project Status
- ✅ Imported from GitHub and configured for Replit environment
- ✅ Backend and frontend running successfully
- ✅ Database connected (Supabase PostgreSQL)
- ✅ Authentication configured (Supabase Auth)
- Last Updated: November 21, 2025

## Technology Stack

### Frontend
- **Framework:** React 19.1.1
- **Build Tool:** Vite 7.1.7
- **Routing:** React Router DOM 7.9.4
- **UI Framework:** Bootstrap 5.3.8
- **State Management:** React Context API
- **Authentication:** Supabase Auth (@supabase/supabase-js)
- **Port:** 5000 (configured for Replit webview)

### Backend
- **Runtime:** Node.js 20
- **Framework:** Express 5.1.0
- **Database ORM:** Drizzle ORM 0.44.7
- **Database:** PostgreSQL (Supabase)
- **Authentication:** Supabase Service Role
- **Port:** 3000 (internal, not exposed)

### Database
- **Provider:** Supabase (Neon-backed PostgreSQL)
- **ORM:** Drizzle
- **Migration Tool:** Drizzle Kit

## Project Structure

```
├── backend/
│   ├── src/
│   │   ├── config/          # Database and Supabase configuration
│   │   ├── controllers/     # Route controllers (auth, pets)
│   │   ├── middleware/      # Auth, logging, error handling
│   │   ├── routers/         # API route definitions
│   │   └── index.js         # Express server entry point
│   ├── package.json
│   └── drizzle.config.js    # Drizzle ORM configuration
│
├── frontend/
│   ├── src/
│   │   ├── api/             # API service layer
│   │   ├── assets/          # Static assets
│   │   ├── components/      # React components
│   │   ├── config/          # Supabase client configuration
│   │   ├── context/         # React context providers (Auth)
│   │   ├── App.jsx          # Main app component
│   │   └── main.jsx         # React entry point
│   ├── package.json
│   └── vite.config.js       # Vite configuration
│
├── docs/                    # Project documentation
├── start.sh                 # Startup script for both services
└── replit.md               # This file
```

## Environment Configuration

### Secrets (Stored in Replit Secrets)
**Important Note:** The secret names are non-standard due to the original setup:
- `DATABASE_URL` - **Contains the Supabase project URL** (https://nyyraxgibahkehtujhpu.supabase.co)
- `SUPABASE_URL` - **Contains the PostgreSQL connection string** (postgresql://...)
- `SUPABASE_ANON_KEY` - Supabase anonymous/public key for frontend
- `SUPABASE_SERVICE_ROLE_KEY` - Supabase service role key for backend admin access

The naming is swapped from what you'd expect, but the application is configured to work with these names.

### Environment Variables (Development)
- `PORT=3000` - Backend server port
- `NODE_ENV=development`
- `VITE_API_URL=http://localhost:3000/api` - Frontend API endpoint
- `SUPABASE_PROJECT_URL=https://nyyraxgibahkehtujhpu.supabase.co` - Actual Supabase project URL
- `FRONTEND_URL=*` - CORS allowed origins

### Frontend Environment Variables
Located in `frontend/.env.local` (automatically generated by `start.sh` from secrets):
- `VITE_SUPABASE_URL` - Supabase project URL (from DATABASE_URL secret)
- `VITE_SUPABASE_ANON_KEY` - Supabase anonymous key (from SUPABASE_ANON_KEY secret)
- `VITE_API_URL` - Backend API endpoint (http://localhost:3000/api)

**Note:** This file is regenerated on each workflow start and is git-ignored.

## Running the Application

### Development Mode (Current Setup)
The application automatically starts via the configured workflow:
```bash
bash start.sh
```

This script:
1. Validates all required Supabase secrets are present (fails fast if any are missing)
2. Generates `frontend/.env.local` with VITE-prefixed environment variables from secrets
3. Starts the backend server on port 3000 in the background
4. Waits for backend health check (polls `/api/health` endpoint up to 30 seconds)
5. Starts the frontend dev server on port 5000 in the background
6. Monitors both processes and captures exit status of the first one to fail
7. Handles graceful shutdown of both services with proper cleanup and exit code propagation

### Manual Commands

**Backend:**
```bash
cd backend
npm start          # Production mode
npm run dev        # Development mode (same as start)
```

**Frontend:**
```bash
cd frontend
npm run dev        # Development server
npm run build      # Production build
npm run preview    # Preview production build
```

**Database:**
```bash
cd backend
npm run db:generate  # Generate migrations
npm run db:push      # Push schema changes
npm run db:studio    # Open Drizzle Studio
```

## API Endpoints

### Health Check
- `GET /` - API information
- `GET /api/health` - Health check endpoint

### Authentication
- `POST /api/auth/login` - User login
- `POST /api/auth/signup` - User registration
- `POST /api/auth/logout` - User logout
- `GET /api/auth/session` - Get current session

### Pets
- `GET /api/pets` - Get all pets (public and authenticated)
- `POST /api/pets` - Create a new pet (requires auth)
- `DELETE /api/pets/:id` - Delete a pet (requires auth)

## Key Features

1. **User Authentication**
   - Sign up / Login via Supabase Auth
   - Session management
   - Protected routes in frontend

2. **Pet Management**
   - Create pet profiles
   - View all pets in the community
   - Delete own pets
   - Interactive "meow counter" feature

3. **Community Features**
   - Browse all pets in the community
   - Public and authenticated access
   - Real-time updates

## Replit-Specific Configuration

### Frontend (Vite)
The `vite.config.js` is configured to work with Replit's proxy system:
```javascript
server: {
  host: '0.0.0.0',        // Required for Replit
  port: 5000,              // Only port exposed to webview
  strictPort: true,
  hmr: {
    clientPort: 443,       // For HMR through proxy
    protocol: 'wss'
  }
}
```

### Backend
- Runs on localhost:3000 (not exposed externally)
- Uses CORS to allow frontend access
- Configured with proper environment variable access

### Workflow
- **Name:** Pet Your Pet App
- **Command:** bash start.sh
- **Output Type:** webview
- **Port:** 5000

## Database Schema

The application uses Drizzle ORM with PostgreSQL. Main tables:
- **users** - User accounts (managed by Supabase Auth)
- **pets** - Pet profiles with owner references

Schema location: `backend/src/config/schema.js`

## Recent Changes (Nov 21, 2025)

1. ✅ Configured backend to run on port 3000 (moved from 5000 to avoid conflict)
2. ✅ Configured frontend Vite to run on 0.0.0.0:5000 for Replit proxy with proper HMR settings
3. ✅ Fixed secret name mapping (DATABASE_URL = Supabase URL, SUPABASE_URL = PostgreSQL connection)
4. ✅ Updated all config files to use correct secret names (backend/src/config/supabase.js, database.js, drizzle.config.js)
5. ✅ Created robust start.sh script with:
   - Required secrets validation (DATABASE_URL, SUPABASE_URL, SUPABASE_ANON_KEY, SUPABASE_SERVICE_ROLE_KEY)
   - Automatic frontend/.env.local generation from secrets at runtime
   - Backend health check via polling `/api/health` (no fixed sleep delays)
   - Concurrent process supervision with proper cleanup traps
   - Exit status propagation (workflow fails if either service crashes)
6. ✅ Removed hard-coded defaults in favor of fail-fast error messages
7. ✅ Updated .gitignore for Node.js best practices
8. ✅ Installed all dependencies for both frontend and backend
9. ✅ Verified application runs successfully in Replit environment

## Troubleshooting

### Frontend not loading
1. Check that workflow is running
2. Verify port 5000 is being used by frontend
3. Check browser console logs
4. Clear cache and hard reload

### Backend API errors
1. Check backend logs in workflow console
2. Verify DATABASE_URL and Supabase credentials are set
3. Test health endpoint: http://localhost:3000/api/health
4. Ensure backend is running before frontend

### Database connection issues
1. Verify DATABASE_URL is correct in secrets
2. Check Supabase project is active
3. Ensure database schema is migrated (run `npm run db:push` in backend)

### CORS errors
1. Verify FRONTEND_URL environment variable
2. Check backend CORS configuration in `backend/src/index.js`

## Deployment

### Replit Deployment
The application is configured for Replit Deploy with:
- **Deployment Type:** autoscale (stateless)
- **Build Command:** Installs dependencies for both frontend and backend, then builds frontend
- **Run Command:** Starts backend on port 3000 and serves frontend static files from Vite preview on port 5000
- **Port:** 5000 (exposed to the internet)

**For production deployment on Replit:**
1. Click the "Deploy" button in the Replit interface
2. Ensure all secrets are set (DATABASE_URL, SUPABASE_URL, SUPABASE_ANON_KEY, SUPABASE_SERVICE_ROLE_KEY)
3. The deployment will automatically build and serve the application

**For external deployment:**
- **Frontend:** Firebase Hosting, Vercel, Netlify, or similar static hosting
- **Backend:** Render, Railway, Fly.io, or similar Node.js hosting
- **Database:** Supabase (already configured)

See `DEPLOYMENT.md` for detailed external deployment instructions.

**Environment Variable Notes for Deployment:**
- When deploying externally, update `VITE_API_URL` in the frontend build to point to your production backend URL
- Backend `FRONTEND_URL` should be set to your production frontend URL for CORS configuration

## User Preferences

*This section will be updated with specific user preferences as they are expressed during development.*

## Next Steps

1. Test all authentication flows
2. Verify all pet CRUD operations work correctly
3. Test protected routes
4. Configure deployment settings for Replit Deploy
5. Set up production environment variables
